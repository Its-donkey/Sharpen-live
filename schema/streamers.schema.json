{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Reviewed streamer records",
  "description": "Normalized streamer roster with platform details and live status.",
  "type": "object",
  "additionalProperties": false,
  "properties": {
    "$schema": {
      "type": "string",
      "description": "Optional reference to this schema."
    },
    "streamers": {
      "type": "array",
      "description": "All persisted streamer records.",
      "items": { "$ref": "#/$defs/record" }
    }
  },
  "required": ["streamers"],
  "$defs": {
    "site": {
      "type": "string",
      "description": "Normalized site key (e.g., default-site, sharpen-live).",
      "pattern": "^[a-z0-9](?:[a-z0-9.-]*[a-z0-9])?$"
    },
    "record": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "site": { "$ref": "#/$defs/site" },
        "streamer": { "$ref": "#/$defs/streamer" },
        "platforms": { "$ref": "#/$defs/platforms" },
        "status": { "$ref": "#/$defs/status" },
        "createdAt": {
          "type": "string",
          "format": "date-time",
          "description": "ISO-8601 timestamp when this record was created.",
          "readOnly": true
        },
        "updatedAt": {
          "type": "string",
          "format": "date-time",
          "description": "ISO-8601 timestamp when this record was last updated.",
          "readOnly": true
        }
      },
      "required": ["streamer", "platforms"]
    },
    "streamer": {
      "type": "object",
      "description": "Streamer profile information.",
      "additionalProperties": false,
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^[A-Za-z0-9]+$",
          "minLength": 1,
          "maxLength": 50,
          "description": "Unique identifier generated by the system.",
          "readOnly": true
        },
        "alias": {
          "type": "string",
          "minLength": 2,
          "maxLength": 50,
          "description": "Display name or alias."
        },
        "description": {
          "type": "string",
          "maxLength": 5000,
          "description": "Brief description of the streamer."
        },
        "firstName": {
          "type": "string",
          "maxLength": 50
        },
        "lastName": {
          "type": "string",
          "maxLength": 50
        },
        "email": {
          "description": "Contact email address (optional).",
          "anyOf": [
            { "type": "string", "format": "email", "minLength": 3, "maxLength": 254 },
            { "type": "string", "maxLength": 0 }
          ]
        },
        "languages": {
          "type": "array",
          "minItems": 1,
          "uniqueItems": true,
          "description": "Languages the streamer broadcasts in.",
          "items": {
            "type": "string",
            "enum": [
              "English",
              "Afrikaans",
              "Albanian",
              "Amharic",
              "Armenian",
              "Azerbaijani",
              "Basque",
              "Belarusian",
              "Bosnian",
              "Bulgarian",
              "Catalan",
              "Cebuano",
              "Croatian",
              "Czech",
              "Danish",
              "Dutch",
              "Estonian",
              "Filipino",
              "Finnish",
              "French",
              "Galician",
              "Georgian",
              "German",
              "Greek",
              "Gujarati",
              "Haitian Creole",
              "Hebrew",
              "Hindi",
              "Hmong",
              "Hungarian",
              "Icelandic",
              "Igbo",
              "Italian",
              "Japanese",
              "Javanese",
              "Kannada",
              "Kazakh",
              "Khmer",
              "Kinyarwanda",
              "Korean",
              "Kurdish",
              "Lao",
              "Latvian",
              "Lithuanian",
              "Luxembourgish",
              "Macedonian",
              "Malay",
              "Malayalam",
              "Maltese",
              "Mandarin",
              "Marathi",
              "Mongolian",
              "Nepali",
              "Norwegian",
              "Pashto",
              "Persian",
              "Polish",
              "Portuguese",
              "Punjabi",
              "Romanian",
              "Serbian",
              "Sinhala",
              "Slovak",
              "Slovenian",
              "Somali",
              "Spanish",
              "Swahili",
              "Swedish",
              "Tamil",
              "Telugu",
              "Thai",
              "Turkish",
              "Ukrainian",
              "Urdu",
              "Uzbek",
              "Vietnamese",
              "Welsh",
              "Xhosa",
              "Yoruba",
              "Zulu"
            ]
          }
        }
      },
      "required": ["alias"]
    },
    "platforms": {
      "type": "object",
      "description": "Configured platform metadata.",
      "minProperties": 1,
      "additionalProperties": false,
      "properties": {
        "youtube": { "$ref": "#/$defs/platformYouTube" },
        "facebook": { "$ref": "#/$defs/platformFacebook" },
        "twitch": { "$ref": "#/$defs/platformTwitch" }
      }
    },
    "status": {
      "type": "object",
      "description": "Derived live/offline status.",
      "additionalProperties": false,
      "properties": {
        "live": { "type": "boolean" },
        "platforms": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["youtube", "twitch", "facebook"]
          },
          "uniqueItems": true
        },
        "youtube": { "$ref": "#/$defs/statusYouTube" },
        "twitch": { "$ref": "#/$defs/statusTwitch" },
        "facebook": { "$ref": "#/$defs/statusFacebook" }
      },
      "required": ["live"]
    },
    "statusYouTube": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "live": { "type": "boolean" },
        "videoId": {
          "type": "string",
          "description": "Live video ID if streaming."
        },
        "startedAt": { "type": "string", "format": "date-time" }
      },
      "required": ["live"]
    },
    "statusTwitch": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "live": { "type": "boolean" },
        "streamId": { "type": "string" },
        "startedAt": { "type": "string", "format": "date-time" }
      },
      "required": ["live"]
    },
    "statusFacebook": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "live": { "type": "boolean" },
        "videoId": { "type": "string" },
        "startedAt": { "type": "string", "format": "date-time" }
      },
      "required": ["live"]
    },
    "platformYouTube": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "handle": {
          "type": "string",
          "pattern": "^@?[A-Za-z0-9._-]{3,30}$",
          "description": "YouTube channel handle."
        },
        "channelId": {
          "type": "string",
          "pattern": "^UC[0-9A-Za-z_-]{22}$",
          "description": "Canonical UC channel ID."
        },
        "channelUrl": {
          "type": "string",
          "format": "uri",
          "pattern": "^https://",
          "description": "Full channel URL."
        },
        "websubHubUrl": {
          "type": "string",
          "format": "uri",
          "pattern": "^https://",
          "description": "WebSub hub URL."
        },
        "websubTopicUrl": {
          "type": "string",
          "format": "uri",
          "pattern": "^https://",
          "description": "WebSub topic URL (videos feed)."
        },
        "websubCallbackUrl": {
          "type": "string",
          "format": "uri",
          "pattern": "^https://",
          "description": "Callback URL for WebSub notifications."
        },
        "websubSecret": {
          "type": "string",
          "minLength": 16,
          "maxLength": 128,
          "description": "Secret used for WebSub signature verification."
        },
        "websubLeaseExpiry": {
          "type": "string",
          "format": "date-time",
          "description": "When the current WebSub lease expires.",
          "readOnly": true
        },
        "websubSubscribed": {
          "type": "boolean",
          "description": "Whether a WebSub subscription is active.",
          "readOnly": true
        }
      },
      "required": ["channelId"]
    },
    "platformFacebook": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "pageId": {
          "type": "string",
          "pattern": "^[0-9]{5,}$",
          "description": "Facebook page identifier."
        },
        "accessToken": {
          "type": "string",
          "minLength": 20,
          "description": "Token used for Graph API calls."
        }
      },
      "required": ["pageId"]
    },
    "platformTwitch": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "username": {
          "type": "string",
          "pattern": "^[a-z0-9_]{4,25}$",
          "description": "Twitch broadcaster username."
        },
        "broadcasterId": {
          "type": "string",
          "pattern": "^[0-9]+$",
          "description": "Twitch broadcaster ID."
        }
      },
      "required": ["username"]
    }
  }
}
