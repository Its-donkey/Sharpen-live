{{define "admin"}}
{{template "base" .}}
{{end}}

{{define "content"}}
<section class="admin-shell admin-lumen" aria-live="polite">
  <header class="surface admin-masthead">
    <div class="masthead-text">
      <p class="eyebrow">Default-site fallback</p>
      <h2 id="admin-console-title">Control Room</h2>
      <p class="admin-help">A calmer view to triage why the fallback is live, toggle integrations, and read logs without jumping tabs.</p>
      <div class="pill-row">
        <span class="pill tone-accent">{{if .FallbackErrors}}Fallback needs attention{{else}}Fallback steady{{end}}</span>
        <span class="pill">Sites detected: {{len .OtherSites}}</span>
        <span class="pill tone-ghost">Logs require auth</span>
      </div>
    </div>
    <div class="masthead-actions">
      {{if .LoggedIn}}
        <div class="button-row">
          <a href="/admin/config" class="action-button ghost">Configuration</a>
          <a href="/logs" class="action-button ghost">Logs</a>
          <form method="post" action="/admin/status-check">
            <button type="submit" class="action-button primary">Refresh status</button>
          </form>
          <form method="post" action="/admin/logout">
            <button type="submit" class="action-button ghost">Log out</button>
          </form>
        </div>
        <p class="admin-help subtle">Signed in. Actions apply across every site loaded beside the fallback.</p>
      {{else}}
        <p class="admin-help subtle">Sign in to unlock configuration, logs, and monitoring controls.</p>
      {{end}}
    </div>
  </header>

  {{if .Flash}}
    <div class="admin-banner success" role="status">{{.Flash}}</div>
  {{end}}
  {{if .Error}}
    <div class="admin-banner error" role="status"><pre style="white-space: pre-wrap; margin: 0; font-family: inherit;">{{.Error}}</pre></div>
  {{end}}

  {{if not .LoggedIn}}
    <div class="admin-grid auth-layout">
      <div class="surface admin-card login-card">
        <div class="admin-card-header">
          <p class="eyebrow">Access controls</p>
          <h3>Log in</h3>
          <p class="admin-help">Use the admin credentials configured on the alert server.</p>
        </div>
        <form method="post" action="/admin/login" class="admin-auth">
          <div class="form-field form-field-wide">
            <span>Email</span>
            <input type="email" name="email" value="{{.AdminEmail}}" autocomplete="username" required />
          </div>
          <div class="form-field form-field-wide">
            <span>Password</span>
            <input type="password" name="password" value="" autocomplete="current-password" required />
          </div>
          <div class="submit-streamer-actions">
            <button type="submit" class="submit-streamer-submit">Access console</button>
          </div>
        </form>
        <p class="admin-help subtle">Unlock configuration, quick status refresh, logs, and monitoring tools.</p>
      </div>

      <div class="surface admin-card info-card">
        <div class="admin-card-header">
          <p class="eyebrow">Fallback snapshot</p>
          <h3>What we know</h3>
        </div>
        {{if .FallbackErrors}}
          <ul class="fallback-list">
            {{range .FallbackErrors}}<li>{{.}}</li>{{end}}
          </ul>
        {{else}}
          <p>No errors were reported while loading the target site.</p>
        {{end}}

        <div class="other-sites">
          <p class="eyebrow">Other sites nearby</p>
          {{if .OtherSites}}
            <div class="site-chip-row">
              {{range .OtherSites}}
                {{if .AdminURL}}
                  <a href="{{.AdminURL}}" class="site-chip" target="_blank" rel="noopener">{{.Name}}</a>
                {{else}}
                  <span class="site-chip">{{.Name}}</span>
                {{end}}
              {{end}}
            </div>
          {{else}}
            <p class="admin-help subtle">No additional sites detected alongside the fallback.</p>
          {{end}}
        </div>
      </div>
    </div>
  {{else}}
    <div class="admin-grid dashboard">
      <div class="surface admin-card stat-deck span-2">
        <div class="admin-card-header">
          <p class="eyebrow">Operational pulse</p>
          <h3>Live snapshot</h3>
        </div>
        <div class="stat-row">
          <div class="stat-chip">
            <p class="stat-label">Fallback errors</p>
            <p class="stat-value">{{len .FallbackErrors}}</p>
            <p class="stat-note">Surfaced during template/config resolution.</p>
          </div>
          <div class="stat-chip">
            <p class="stat-label">Discovered sites</p>
            <p class="stat-value">{{len .OtherSites}}</p>
            <p class="stat-note">Directories loaded alongside default-site.</p>
          </div>
          <div class="stat-chip">
            <p class="stat-label">YouTube sites</p>
            <p class="stat-value">{{len .YouTubeSites}}</p>
            <p class="stat-note">Managed via Configuration page.</p>
          </div>
        </div>
      </div>

      <div class="surface admin-card info-card">
        <div class="admin-card-header">
          <p class="eyebrow">Investigation</p>
          <h3>Fallback issues</h3>
        </div>
        {{if .FallbackErrors}}
          <ul class="fallback-list">
            {{range .FallbackErrors}}<li>{{.}}</li>{{end}}
          </ul>
        {{else}}
          <p class="admin-help subtle">No specific errors were captured. Check logs for more detail.</p>
        {{end}}
      </div>

      <div class="surface admin-card info-card">
        <div class="admin-card-header">
          <p class="eyebrow">Topology</p>
          <h3>Other sites</h3>
          <p class="admin-help">Cross-check what else is deployed alongside the fallback.</p>
        </div>
        {{if .OtherSites}}
          <div class="site-chip-row">
            {{range .OtherSites}}
              {{if .AdminURL}}
                <a href="{{.AdminURL}}" class="site-chip" target="_blank" rel="noopener">{{.Name}}</a>
              {{else}}
                <span class="site-chip">{{.Name}}</span>
              {{end}}
            {{end}}
          </div>
        {{else}}
          <p>No additional sites were found alongside the default site.</p>
        {{end}}
      </div>

    </div>
  {{end}}
</section>
{{end}}
