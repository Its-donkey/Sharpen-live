{{define "submit_form"}}
<section class="submit-streamer" id="submit" aria-labelledby="submit-streamer-title">
  <div class="submit-streamer-header">
    <h2 id="submit-streamer-title">Know a streamer we should feature?</h2>
    <p class="submit-streamer-help">Share the details below and our team will review the submission before adding the streamer to the roster. No additional access is required.</p>
  </div>

  <form class="submit-streamer-form" id="submit-streamer-form" method="post" action="{{if .FormAction}}{{.FormAction}}{{else}}/submit{{end}}">
    <div class="form-grid">
      <fieldset class="platform-fieldset form-field-wide">
        <legend>Streaming platforms *</legend>
        <p class="submit-streamer-help">Add each platform’s name and channel URL. If they’re the same stream link, repeat the URL.</p>
        <div class="platform-rows">
          {{range $idx, $row := .State.Platforms}}
            {{$rowErr := index $.State.Errors.Platforms $row.ID}}
            <div class="platform-row" data-platform-row="{{$row.ID}}">
              <div class="platform-row-inner">
                <label class="form-field form-field-inline platform-url highlight-change {{if $rowErr.Channel}}form-field-error{{end}}" id="platform-url-field-{{$row.ID}}">
                  <span>Channel URL</span>
                  <input type="hidden" name="platform_id" value="{{$row.ID}}">
                  <input type="url" class="channel-url-input" name="platform_url" placeholder="https://example.com/live or @handle" value="{{$row.ChannelURL}}" required>
                </label>
                <label class="form-field form-field-inline platform-select">
                  <span>Handle platform</span>
                  <select class="platform-select-input" data-platform-choice data-row="{{$row.ID}}">
                    <option value="" {{if eq (lower $row.Preset) ""}}selected{{end}}>Select a platform…</option>
                    <option value="youtube" {{if eq (lower $row.Preset) "youtube"}}selected{{end}}>YouTube</option>
                    <option value="twitch" {{if eq (lower $row.Preset) "twitch"}}selected{{end}}>Twitch</option>
                    <option value="facebook" {{if eq (lower $row.Preset) "facebook"}}selected{{end}}>Facebook</option>
                  </select>
                </label>
              </div>
              {{if gt (len $.State.Platforms) 1}}
                <button type="submit" class="remove-platform-button" name="remove_platform" value="{{$row.ID}}">Remove</button>
              {{end}}
              {{if $rowErr.Channel}}
                <p class="field-error-text">Provide a valid channel URL.</p>
              {{end}}
            </div>
          {{end}}
        </div>
        <button type="submit" class="add-platform-button" name="action" value="add-platform" {{if ge (len .State.Platforms) .MaxPlatforms}}disabled{{end}}>+ Add another platform</button>
      </fieldset>

      <label class="form-field {{if .State.Errors.Name}}form-field-error{{end}}" id="field-name">
        <span>Streamer name *</span>
        <input type="text" id="streamer-name" name="name" value="{{.State.Name}}" required>
      </label>

      <label class="form-field form-field-wide {{if .State.Errors.Description}}form-field-error{{end}}" id="field-description">
        <span>Description *</span>
        <p class="submit-streamer-help">What does the streamer do and what makes their streams unique?</p>
        <textarea id="streamer-description" name="description" rows="3" required>{{.State.Description}}</textarea>
      </label>

      <label class="form-field form-field-wide {{if .State.Errors.Languages}}form-field-error{{end}}" id="field-languages">
        <span>Languages *</span>
        <p class="submit-streamer-help">Select every language the streamer uses on their channel.</p>
        <div class="language-picker">
          <select class="language-select" id="language-select" name="language-picker">
            <option value="">Select a language…</option>
            {{range .LanguageOptions}}
              <option value="{{.Value}}" {{if contains $.State.Languages .Value}}data-selected="true"{{end}}>{{.Label}}</option>
            {{end}}
          </select>
          <div class="language-tags">
            {{if .State.Languages}}
              {{range .State.Languages}}
                <span class="language-pill">{{displayLanguage .}}</span>
              {{end}}
            {{else}}
              <span class="language-empty">No languages selected yet.</span>
            {{end}}
          </div>
        </div>
        {{if .State.Errors.Languages}}
          <p class="field-error-text">Select at least one language.</p>
        {{end}}
      </label>
    </div>

    <div class="submit-streamer-actions">
      <button type="submit" class="submit-streamer-submit" name="action" value="submit">Submit streamer</button>
      <a class="submit-streamer-cancel" id="submit-cancel" href="/">Cancel</a>
    </div>

    {{if .State.ResultState}}
      <div class="submit-streamer-result" data-state="{{.State.ResultState}}" role="status">{{.State.ResultMessage}}</div>
    {{end}}
  </form>
</section>
{{end}}
