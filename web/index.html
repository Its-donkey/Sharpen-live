<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Sharpen.Live</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <header class="surface site-header">
      <div class="logo-lockup">
        <div class="logo-icon" aria-hidden="true">
          <svg viewBox="0 0 120 120" role="img" aria-labelledby="sharpen-logo-title">
            <title id="sharpen-logo-title">Sharpen Live logo</title>
            <defs>
              <linearGradient id="bladeGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" stop-color="#f8fafc" stop-opacity="0.95"></stop>
                <stop offset="55%" stop-color="#cbd5f5" stop-opacity="0.85"></stop>
                <stop offset="100%" stop-color="#7dd3fc" stop-opacity="0.95"></stop>
              </linearGradient>
            </defs>
            <path
              d="M14 68c12-20 38-54 80-58l6 36c-12 6-26 14-41 26l-45-4z"
              fill="url(#bladeGradient)"
              stroke="#0f172a"
              stroke-width="4"
              stroke-linecap="round"
              stroke-linejoin="round"
            ></path>
            <path
              d="M19 76l35 4c-5 5-10 11-15 18l-26-8 6-14z"
              fill="rgba(15, 23, 42, 0.45)"
              stroke="#0f172a"
              stroke-width="3.5"
              stroke-linecap="round"
              stroke-linejoin="round"
            ></path>
            <circle cx="32" cy="92" r="6" fill="#38bdf8"></circle>
            <circle cx="88" cy="36" r="6" fill="#38bdf8"></circle>
          </svg>
        </div>
        <div class="logo-text">
          <h1>Sharpen.Live</h1>
          <p>Streaming Knife Craftsmen</p>
        </div>
      </div>
      <a class="cta" href="#streamers">Become a Partner</a>
    </header>

    <main class="surface" id="streamers" aria-labelledby="streamers-title">
      <section class="intro">
        <h2 id="streamers-title" style="margin: 0 0 1rem; font-size: clamp(1.8rem, 2vw + 1rem, 2.4rem); font-family: var(--font-heading);">
          Live Knife Sharpening Studio
        </h2>
        <p style="margin: 0; color: var(--fg-muted); max-width: 720px; line-height: 1.7;">
          Discover bladesmiths and sharpening artists streaming in real time. Status indicators
          show who is live, who is prepping off camera, and who is offline. Premium partners share
          their booking links so you can send in your knives for a professional edge.
        </p>
      </section>

      <section class="streamer-table" aria-label="Sharpen Live streamer roster">
        <table>
          <thead>
            <tr>
              <th scope="col">Status</th>
              <th scope="col">Name</th>
              <th scope="col">Streaming Platforms</th>
              <th scope="col">Language</th>
            </tr>
          </thead>
          <tbody id="streamers-table-body"></tbody>
        </table>
      </section>
    </main>

    <footer>
      <span>&copy; <span id="current-year"></span> Sharpen Live. All rights reserved.</span>
      <span>
        Interested in the roster?
        <a href="mailto:partners@sharpen.live">partners@sharpen.live</a>
      </span>
    </footer>

    <script>
      const currentYearElement = document.getElementById("current-year");
      if (currentYearElement) {
        currentYearElement.textContent = new Date().getFullYear();
      }

      const tableBody = document.getElementById("streamers-table-body");
      const STATUS_CLASS_FALLBACK = "offline";
      const STATUS_LABEL_FALLBACK = "Offline";

      const createStatusCell = (streamer) => {
        const statusCell = document.createElement("td");
        statusCell.dataset.label = "Status";

        const span = document.createElement("span");
        const state = (streamer.status || STATUS_CLASS_FALLBACK).toLowerCase();
        span.className = `status ${state}`;
        span.textContent = streamer.statusLabel || STATUS_LABEL_FALLBACK;

        statusCell.appendChild(span);
        return statusCell;
      };

      const createNameCell = (streamer) => {
        const nameCell = document.createElement("td");
        nameCell.dataset.label = "Name";

        const strong = document.createElement("strong");
        strong.textContent = streamer.name;
        nameCell.appendChild(strong);

        if (streamer.description) {
          const description = document.createElement("div");
          description.className = "streamer-description";
          description.textContent = streamer.description;
          nameCell.appendChild(description);
        }

        return nameCell;
      };

      const createPlatformCell = (streamer) => {
        const platformCell = document.createElement("td");
        platformCell.dataset.label = "Streaming Platforms";

        const platforms = Array.isArray(streamer.platforms) ? streamer.platforms : [];
        if (!platforms.length) {
          platformCell.textContent = "—";
          return platformCell;
        }

        const list = document.createElement("ul");
        list.className = "platform-list";

        const state = (streamer.status || STATUS_CLASS_FALLBACK).toLowerCase();
        const isLive = state === "online";

        platforms.forEach((platform) => {
          const listItem = document.createElement("li");
          const link = document.createElement("a");
          link.className = "platform-link";
          link.textContent = platform.name;

          const liveUrl = platform.liveUrl || platform.channelUrl;
          const channelUrl = platform.channelUrl || platform.liveUrl;
          const targetUrl = isLive ? liveUrl : channelUrl;

          if (targetUrl) {
            link.href = targetUrl;
            link.target = "_blank";
            link.rel = "noopener noreferrer";
          } else {
            link.setAttribute("aria-disabled", "true");
            link.tabIndex = -1;
          }

          listItem.appendChild(link);
          list.appendChild(listItem);
        });

        platformCell.appendChild(list);
        return platformCell;
      };

      const createLanguageCell = (streamer) => {
        const languageCell = document.createElement("td");
        languageCell.dataset.label = "Language";

        const languages = Array.isArray(streamer.languages)
          ? streamer.languages.join(" · ")
          : streamer.languages || "—";

        const span = document.createElement("span");
        span.className = "lang";
        span.textContent = languages;
        languageCell.appendChild(span);

        return languageCell;
      };

      const renderStreamerRow = (streamer) => {
        const row = document.createElement("tr");
        row.appendChild(createStatusCell(streamer));
        row.appendChild(createNameCell(streamer));
        row.appendChild(createPlatformCell(streamer));
        row.appendChild(createLanguageCell(streamer));
        return row;
      };

      const renderStreamers = (streamers) => {
        if (!tableBody) {
          return;
        }

        tableBody.innerHTML = "";

        if (!Array.isArray(streamers) || !streamers.length) {
          const emptyStateRow = document.createElement("tr");
          const cell = document.createElement("td");
          cell.colSpan = 4;
          cell.textContent = "No streamers available at the moment.";
          emptyStateRow.appendChild(cell);
          tableBody.appendChild(emptyStateRow);
          return;
        }

        streamers.forEach((streamer) => {
          tableBody.appendChild(renderStreamerRow(streamer));
        });
      };

      const loadStreamers = async () => {
        if (!tableBody) {
          return;
        }

        try {
          const response = await fetch("streamers.json", { cache: "no-cache" });
          if (!response.ok) {
            throw new Error(`Unexpected response: ${response.status}`);
          }
          const streamers = await response.json();
          renderStreamers(streamers);
        } catch (error) {
          console.error("Failed to load streamer roster", error);
          const errorRow = document.createElement("tr");
          const cell = document.createElement("td");
          cell.colSpan = 4;
          cell.textContent = "Unable to load streamers right now. Please try again later.";
          errorRow.appendChild(cell);
          tableBody.innerHTML = "";
          tableBody.appendChild(errorRow);
        }
      };

      loadStreamers();
    </script>
  </body>
</html>
